

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>The DroneNadir workflow &mdash; MicMacWorkflows 1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Installation and Setup" href="../setup.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> MicMacWorkflows
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../setup.html">Installation and Setup</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">The DroneNadir workflow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#expected-data-input">Expected data input</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-the-script">Running the script</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MicMacWorkflows</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>The DroneNadir workflow</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorials/DroneNadir.sh.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-dronenadir-workflow">
<h1>The DroneNadir workflow<a class="headerlink" href="#the-dronenadir-workflow" title="Permalink to this headline">¶</a></h1>
<p>This workflow is designed for drone images taken at nadir (or close to nadir) containing GNSS location data. It was created and tested using images from a DJI Mavic Pro and should run for all similar drones (other DJI products for instance), and also for more “serious” aerial photography systems.</p>
<div class="section" id="expected-data-input">
<h2>Expected data input<a class="headerlink" href="#expected-data-input" title="Permalink to this headline">¶</a></h2>
<p>First, I would like to remind users that an along-track overlap of 80% and across track overlap of 60% are the minimum recommended values when flying a survey.</p>
<p>Secondly, the only input requiered for this workflow is images that include a geolocation tag in their EXIF metadata.</p>
<p>The current version of the script only supports UTM zones as the output coordinate system. It can easily adapted to run any EPSG code.</p>
</div>
<div class="section" id="running-the-script">
<h2>Running the script<a class="headerlink" href="#running-the-script" title="Permalink to this headline">¶</a></h2>
<p>From the included help</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">DroneNadir</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">e</span> <span class="n">JPG</span> <span class="o">-</span><span class="n">x</span> <span class="mi">55000</span> <span class="o">-</span><span class="n">y</span> <span class="mi">6600000</span> <span class="o">-</span><span class="n">u</span> <span class="s2">&quot;32 +north&quot;</span> <span class="o">-</span><span class="n">p</span> <span class="n">true</span> <span class="o">-</span><span class="n">r</span> <span class="mf">0.05</span>
    <span class="o">-</span><span class="n">e</span> <span class="n">EXTENSION</span>     <span class="p">:</span> <span class="n">image</span> <span class="n">file</span> <span class="nb">type</span> <span class="p">(</span><span class="n">JPG</span><span class="p">,</span> <span class="n">jpg</span><span class="p">,</span> <span class="n">TIF</span><span class="p">,</span> <span class="n">png</span><span class="o">...</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">JPG</span><span class="p">)</span><span class="o">.</span>
    <span class="o">-</span><span class="n">x</span> <span class="n">X_OFF</span>         <span class="p">:</span> <span class="n">X</span> <span class="p">(</span><span class="n">easting</span><span class="p">)</span> <span class="n">offset</span> <span class="k">for</span> <span class="n">ply</span> <span class="n">file</span> <span class="n">overflow</span> <span class="n">issue</span> <span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span>
    <span class="o">-</span><span class="n">y</span> <span class="n">Y_OFF</span>         <span class="p">:</span> <span class="n">Y</span> <span class="p">(</span><span class="n">northing</span><span class="p">)</span> <span class="n">offset</span> <span class="k">for</span> <span class="n">ply</span> <span class="n">file</span> <span class="n">overflow</span> <span class="n">issue</span> <span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span>
    <span class="o">-</span><span class="n">u</span> <span class="n">UTMZONE</span>       <span class="p">:</span> <span class="n">UTM</span> <span class="n">Zone</span> <span class="n">of</span> <span class="n">area</span> <span class="n">of</span> <span class="n">interest</span><span class="o">.</span> <span class="n">Takes</span> <span class="n">form</span> <span class="s1">&#39;NN +north(south)&#39;</span>
    <span class="o">-</span><span class="n">v</span> <span class="n">PROJ</span>          <span class="p">:</span> <span class="n">PROJ</span><span class="o">.</span><span class="mi">4</span> <span class="n">string</span> <span class="k">for</span> <span class="n">coordinate</span> <span class="n">system</span> <span class="n">of</span> <span class="n">output</span> <span class="p">(</span><span class="n">use</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">UTM</span><span class="p">)</span>
    <span class="o">-</span><span class="n">s</span> <span class="n">SH</span>            <span class="p">:</span> <span class="n">Do</span> <span class="ow">not</span> <span class="n">use</span> <span class="s1">&#39;Schnaps&#39;</span> <span class="n">optimised</span> <span class="n">homologous</span> <span class="n">points</span><span class="o">.</span>
    <span class="o">-</span><span class="n">p</span> <span class="n">do_ply</span>        <span class="p">:</span> <span class="n">use</span> <span class="n">to</span> <span class="n">NOT</span> <span class="n">export</span> <span class="n">ply</span> <span class="n">file</span><span class="o">.</span>
    <span class="o">-</span><span class="n">c</span> <span class="n">regul</span>         <span class="p">:</span> <span class="n">use</span> <span class="n">to</span> <span class="n">activate</span> <span class="n">color</span> <span class="n">equalization</span> <span class="ow">in</span> <span class="n">mosaicking</span> <span class="p">(</span><span class="n">only</span> <span class="n">do</span> <span class="k">with</span> <span class="n">good</span> <span class="n">camera</span><span class="p">,</span> <span class="n">eg</span> <span class="n">NOT</span> <span class="n">DJI</span><span class="p">)</span><span class="o">.</span>
    <span class="o">-</span><span class="n">a</span> <span class="n">do_AperiCloud</span> <span class="p">:</span> <span class="n">use</span> <span class="n">to</span> <span class="n">NOT</span> <span class="n">export</span> <span class="n">AperiCloud</span> <span class="n">file</span><span class="o">.</span>
    <span class="o">-</span><span class="n">o</span> <span class="n">obliqueFolder</span> <span class="p">:</span> <span class="n">Folder</span> <span class="k">with</span> <span class="n">oblique</span> <span class="n">imagery</span> <span class="n">to</span> <span class="n">help</span> <span class="n">orientation</span> <span class="p">(</span><span class="n">will</span> <span class="n">be</span> <span class="n">entierely</span> <span class="n">copied</span> <span class="n">then</span> <span class="n">deleted</span> <span class="n">during</span> <span class="n">process</span><span class="p">)</span><span class="o">.</span>
    <span class="o">-</span><span class="n">r</span> <span class="n">RESOL</span>         <span class="p">:</span> <span class="n">Ground</span> <span class="n">resolution</span> <span class="p">(</span><span class="ow">in</span> <span class="n">meters</span><span class="p">)</span>
    <span class="o">-</span><span class="n">z</span> <span class="n">ZoomF</span>         <span class="p">:</span> <span class="n">Last</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">pyramidal</span> <span class="n">dense</span> <span class="n">correlation</span> <span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">can</span> <span class="n">be</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="o">-</span><span class="n">t</span> <span class="n">Clean</span><span class="o">-</span><span class="n">up</span>      <span class="p">:</span> <span class="n">Remove</span> <span class="n">most</span> <span class="n">temporary</span> <span class="n">files</span> <span class="n">after</span> <span class="n">the</span> <span class="n">process</span> <span class="ow">is</span> <span class="n">over</span> <span class="p">(</span><span class="n">Option</span> <span class="mi">0</span><span class="p">(</span><span class="n">default</span><span class="p">)</span><span class="o">=</span><span class="n">no</span> <span class="mi">1</span><span class="o">=</span><span class="n">allows</span> <span class="k">for</span> <span class="n">further</span> <span class="n">processing</span> <span class="mi">2</span><span class="o">=</span><span class="n">keep</span> <span class="n">only</span> <span class="n">final</span> <span class="n">files</span><span class="p">)</span>
    <span class="o">-</span><span class="n">h</span>               <span class="p">:</span> <span class="n">displays</span> <span class="n">this</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exits</span><span class="o">.</span>
</pre></div>
</div>
<p>More details for some select options:</p>
<ul class="simple">
<li><strong>-x</strong> and <strong>-y</strong> define an offset so the exported 32bits ply files do not have an overflow issue and round the points’ coordinates. Without them, the point cloud would appear with lines of points at regular intervals much higher than the expected pitch. The exact values here don’t matter very much, but “somewhere in the survey domain” is the recommendation. The coordinates need to be given in the same system as the export system (defined next with -u).</li>
<li><strong>-u</strong> defined the UTM zone of the final products. The format is “NN +hemisphere”, so, for UTM32N (EPSG:32632), the expected value is <strong>“32 +north”</strong>, and for UTM5S (EPSG:32705) <strong>“5 +south”</strong>.</li>
<li><strong>-v</strong> offers an option to use any projection system that PROJ.4 can use. You then have to put a full proj string, for instance for UTM32N : <strong>“+proj=UTM +zone=32 +north +ellps=WGS84 +datum=WGS84 +units=m +no_defs”</strong></li>
<li><strong>-s</strong> Schnaps is a tie point optimiser that reduces the amount of tie points while optimising their distributions in the images. It also removes images that do not have enough tie points. It is <strong>switch on</strong> by default.</li>
<li><strong>-p</strong> By default, the workflow exports a point cloud of the final DEM. You can suppress that functionnality with this option.</li>
<li><strong>-c</strong> By default, the mosaicking of the individually orthorectified images is done without any colour balancing and equalization. This is because MicMac is pretty bad at this and often produces rather poor results.</li>
<li><strong>-a</strong> Like -p, but for the low density point cloud made from the tie points.</li>
<li><strong>-o</strong> Option to add non-nadir imagery in the orientation to improve the relative accuracy of the model and avoid the banana/doming effect. These images have to be in a subfolder, and need to satisfy the same requierment than the main set.</li>
<li><strong>-r</strong> Forces the GSD (Ground Sampling Distance) of the final product to be fixed to a user chosen value instead of being automatically chosen. This is mostly usefull if the product is to be compared with another product. The resolution given here will be the one of the orthoimage, and the one of the DEM if the next option <strong>-z</strong> is equal to 1. The GSD of the DEM is multiplied by the value of <strong>-z</strong> (def 2).</li>
<li><strong>-z</strong> Defines the last step of the dense correlation. At 1, the images are used at full resolution in the correlation step, which is usually a waste of time when using colour images coming from a bayer matrix sensor, as the real resolution is closer to half of the nominal value. That is why the <strong>default is 2</strong>. Indreasing the value to 4 or 8 will make the process faster and yield a lower resolution model, potentially more complete in some cases.</li>
<li><strong>-t</strong> The cleanup options allow to automatically remove temporary files with different level of clean, from no cleanup to complete cleanup only leaving the input and output data. The intermediate option <strong>-t 1</strong> allows the user to conduct further processing of the data, such as adding GCPs, trying different correlation parameters, changing orthomosaicking approach and so on.</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../setup.html" class="btn btn-neutral float-left" title="Installation and Setup" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Luc Girod

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>